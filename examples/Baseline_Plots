import csv
import matplotlib.pyplot as plt
plt.rcParams['pdf.fonttype'] = 42

# === File paths and labels ===
file_paths = [
    'HOCLF_allowable_force_200.csv',
    'potential_0.005.csv',
    'HOCLF_notouch.csv',
    'PID_8.csv',
    'HOCLF_allowable_force_8.csv',
]

labels = [
    'Safety Unaware HOCLF', 
    'Contact Avoid. Artif. Potential', 
    'Contact Avoid. HOCLF+HOCBF',
    'Contact Force-Limit HOCBF Filter', 
    'Contact Force-Limit HOCLF+HOCBF'
]

# === Containers for time series data ===
time_list = []
error_list = []
force_list = []

# === Read all CSV files ===
for path in file_paths:
    times = []
    errors = []
    forces = []
    with open(path, 'r') as f:
        reader = csv.DictReader(f)
        for row in reader:
            times.append(float(row['time']))
            errors.append(float(row['tracking_error']))
            forces.append(float(row['contact_force']))
    time_list.append(times)
    error_list.append(errors)
    force_list.append(forces)

# === Set global font size ===
plt.rcParams.update({
    'font.size': 16,              # main font size
    'axes.titlesize': 28,         # title size
    'axes.labelsize': 28,         # x/y label size
    'xtick.labelsize': 13,        # tick label size
    'ytick.labelsize': 13,
    'legend.fontsize': 24
})

# === Plot 1: Tracking Error over Time ===
plt.figure(figsize=(10, 10))
for i in range(len(file_paths)):
    plt.plot(time_list[i], error_list[i], label=labels[i], linewidth=4)
# plt.title('Regulation Error over Time')
plt.xlabel('Time (s)')
plt.ylabel('Regulation Error (m)')
plt.ylim(0, 0.4)
plt.legend(loc='upper right', framealpha=0.3)  # Transparent legend
plt.grid(True)
plt.tight_layout()
plt.savefig('tracking_error_over_time.pdf')
plt.show()

# === Plot 2: Contact Force over Time with red threshold fill ===
plt.figure(figsize=(10, 10))
threshold = 0.005 * 3000  # = 15N

for i in range(len(file_paths)):
    plt.plot(time_list[i], force_list[i], label=labels[i], linewidth=4)

# Fill area above threshold
all_times_flat = sorted(set(sum(time_list, [])))
plt.fill_between(all_times_flat, threshold, max(max(f) for f in force_list),
                 color='red', alpha=0.1, label='Unsafe Zone (15N)')
plt.axhline(threshold, color='red', linestyle='--', linewidth=1)

# plt.title('Contact Force over Time')
plt.xlabel('Time (s)')
plt.ylabel('Contact Force (N)')
plt.legend(loc='upper right', framealpha=0.3)  # Transparent legend
plt.grid(True)
plt.tight_layout()
plt.savefig('contact_force_over_time.pdf')
plt.show()
